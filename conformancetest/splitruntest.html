<!doctype html>
<meta charset=utf-8>
<link rel=stylesheet href=../css/reset.css>
<title>HTML editing conformance tests (split version)</title>
<p>See the <a href=editing.html#tests>Tests</a> section of the specification
for documentation.

<p id=picker>

<p id=timing></p>

<div id=log></div>

<div id=test-container></div>

<script src=../implementation.js></script>
<script>var testsJsLibraryOnly = true</script>
<script src=../tests.js></script>
<script src=data.js></script>
<script src=http://dvcs.w3.org/hg/html/raw-file/tip/tests/resources/testharness.js></script>
<script src=http://dvcs.w3.org/hg/html/raw-file/tip/tests/resources/testharnessreport.js></script>
<script>
"use strict";

(function() {
	var startTime = Date.now();

	// Make document.body.innerHTML more tidy by removing unnecessary things.
	// We can't remove the testharness.js script, because at the time of this
	// writing, for some reason that stops it from adding appropriate CSS.
	[].forEach.call(document.querySelectorAll("script"), function(node) {
		if (!/testharness\.js$/.test(node.src)) {
			node.parentNode.removeChild(node);
		}
	});

	var groupedBrowserTests = {};
	for (var i = 0; i < browserTests.length; i++) {
		var commands = browserTests[i][1];
		if (commands.length == 2
		&& commands[0][0] == "stylewithcss") {
			// Regular test, not a multitest
			if (!(commands[1][0] in groupedBrowserTests)) {
				groupedBrowserTests[commands[1][0]] = [];
			}
			groupedBrowserTests[commands[1][0]].push(browserTests[i]);
		} else {
			// Multitest
			if (!("multitest" in groupedBrowserTests)) {
				groupedBrowserTests.multitest = [];
			}
			groupedBrowserTests.multitest.push(browserTests[i]);
		}
	}

	var pickerContents = "Select a group of tests to run:";
	for (var group in groupedBrowserTests) {
		pickerContents += " <a href=?" + group + ">" + group + "</a>";
	}
	document.querySelector("#picker").innerHTML = pickerContents;

	var command = location.search.replace(/^\?/, "");
	if (!(command in groupedBrowserTests)) {
		return;
	}
	browserTests = groupedBrowserTests[command];

	browserTests.forEach(runConformanceTest);

	document.getElementById("test-container").parentNode
		.removeChild(document.getElementById("test-container"));

	var elapsed = Math.round(Date.now() - startTime)/1000;
	document.getElementById("timing").textContent =
		"Time elapsed: " + Math.floor(elapsed/60) + ":" + (elapsed % 60).toFixed(3) + " min.";
})();
</script>
